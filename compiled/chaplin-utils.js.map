{"version":3,"sources":["src/chaplin-utils.coffee"],"names":[],"mappings":"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","file":"compiled/chaplin-utils.js","sourcesContent":["mediator = Chaplin.mediator\nroot = this\n\nclass ChapinUtils\n  constructor: (options) ->\n    # required\n    @site = options.site\n    @enable = options.enable\n    @verbosity = options.verbosity\n    @urls = options.urls\n\n    # optional\n    @localhost = options?.localhost\n    @ua = options?.ua\n    @log_interval = options?.log_interval ? 5000\n    @google = options?.google\n\n  JQUERY_EVENTS: \"\"\"\n    blur focus focusin focusout load resize scroll unload click dblclick\n    mousedown mouseup  mousemove mouseover mouseout mouseenter mouseleave\n    change select submit keydown keypress keyup error\n    \"\"\"\n\n  init: =>\n    Minilog\n      .enable()\n      .pipe new Minilog.backends.jQuery\n        url: @urls.logger\n        interval: @log_interval\n\n    @logger = Minilog @site.id\n    @analytics = @google?.analytics\n    @subdomain = @site?.subdomain\n    @google_analytics_id = \"#{@analytics?.id}-#{@analytics?.site_number}\"\n\n  initGA: =>\n    if @localhost\n      cookie_domain = {cookieDomain: 'none'}\n    else\n      cookie_domain = 'auto'\n\n    ga 'create', @google_analytics_id, cookie_domain\n    ga 'require', 'displayfeatures'\n\n  changeURL: (url) -> Backbone.history.navigate url, trigger: false\n\n  smoothScroll: (postion) ->\n    $('html, body').animate scrollTop: postion, devconfig.scroll_time, 'linear'\n\n  toggleOrderby: ->\n    mediator.setOrderby if mediator.orderby is 'asc' then 'desc' else 'asc'\n\n  filterFeed: (feed, page) ->\n    if page?.filterby?.key and page?.filterby?.value\n      new Chaplin.Collection feed.filter (rfp) ->\n        rfp.get(page.filterby.key) is JSON.parse page.filterby.value\n    else\n      feed\n\n  makeFilterer: (filterby, tab, flip=null) ->\n    (model) ->\n      if tab?.filterby?.key and tab?.filterby?.value\n        filter1 = model.get(tab.filterby.key) is tab.filterby.value\n      else\n        filter1 = true\n\n      if filterby?.key and filterby?.value and filterby.key is 'tag'\n        filter2 = filterby.value in model.get 'k:tags'\n      else if filterby?.key and filterby?.value\n        filter2 = model.get(filterby.key) is filterby.value\n      else\n        filter2 = true\n\n      filter1 and filter2\n\n  makeComparator: (sortby=null, orderby=null) ->\n    sortby = sortby ? mediator.sortby\n    orderby = orderby ? mediator.orderby\n    (model) -> (if orderby is 'asc' then 1 else -1) * model.get sortby\n\n  getTags: (collection) ->\n    _.uniq(_.flatten collection.pluck 'k:tags').sort()\n\n  # Logging helper\n  # ---------------------\n  _getPriority: (level) ->\n    switch level\n      when 'debug' then 1\n      when 'info' then 2\n      when 'warn' then 3\n      when 'error' then 4\n      when 'pageview' then 5\n      when 'screenview' then 6\n      when 'event' then 7\n      when 'transaction' then 8\n      when 'item' then 9\n      when 'social' then 10\n      else 0\n\n  log: (message, level='debug', options=null) =>\n    priority = @_getPriority level\n    options = options ? {}\n\n    local_enabled = @enable.logger.local\n    remote_enabled = @enable.logger.remote\n    tracking_enabled = @analytics?.id and @enable.tracker\n\n    local_priority = priority >= @verbosity.logger.local\n    remote_priority = priority >= @verbosity.logger.remote\n    tracker_priority = priority >= @verbosity.tracker\n\n    log_local = local_enabled and local_priority\n    log_remote = remote_enabled and remote_priority\n    track = tracking_enabled and tracker_priority\n\n    if log_local and priority >= @verbosity.tracker\n      console.log \"#{level} for #{message}\"\n    else if log_local\n      console.log message\n\n    if log_remote or track\n      user_options =\n        time: (new Date()).getTime()\n        user: mediator?.user?.get('email')\n\n    if log_remote\n      text = JSON.stringify message\n      message = if text.length > 512 then \"size exceeded\" else message\n      data = _.extend {message: message}, user_options\n      @logger[level] data\n\n    if track\n      if config?.subdomain?\n        url = \"/#{config.subdomain}#{mediator.url}\"\n      else\n        url = mediator.url\n\n      ga (tracker) ->\n        hit_options =\n          v: 1\n          tid: @google_analytics_id\n          cid: tracker.get 'clientId'\n          uid: mediator?.user?.get('id')\n          # uip: ip address\n          dr: document.referrer or 'direct'\n          ua: @ua\n          gclid: @google?.adwords_id\n          dclid: @google?.displayads_id\n          sr: \"#{screen.width}x#{screen.height}\"\n          vp: \"#{$(window).width()}x#{$(window).height()}\"\n          t: level\n          an: @site.title\n          aid: @site.id\n          av: @site.version\n          dp: url\n          dh: document.location.hostname\n          dt: message\n\n        switch level\n          when 'event'\n            hit_options = _.extend hit_options,\n              ec: options.category\n              ea: options.action\n              ev: options?.value\n              el: options?.label ? 'N/A'\n\n          when 'transaction'\n            hit_options = _.extend hit_options,\n              ti: options.trxn_id\n              tr: options?.amount ? 0\n              ts: options?.shipping ? 0\n              tt: options?.tax ? 0\n              cu: options?.cur ? 'USD'\n              ta: options?.affiliation ? 'N/A'\n\n          when 'item'\n            hit_options = _.extend hit_options,\n              ti: options.trxn_id\n              in: options.name\n              ip: options?.amount ? 0\n              iq: options?.qty ? 1\n              cu: options?.cur ? 'USD'\n              ic: options?.sku ? 'N/A'\n              iv: options?.category ? 'N/A'\n\n          when 'social'\n            hit_options = _.extend hit_options,\n              sn: options?.network ? 'facebook'\n              sa: options?.action ? 'like'\n              st: options?.target ? mediator.url\n\n        if level is 'experiment'\n          hit_options = _.extend hit_options,\n            xid: options.xid\n            xvar: options?.xvar ? 'A'\n\n        data = _.extend options, user_options, hit_options\n        $.post @urls.tracker, data\n\nif exports? and module?.exports\n  exports = module.exports = ChapinUtils\nelse if exports?\n  # Node.js\n  exports.ChapinUtils = ChapinUtils\nelse if (typeof define is 'function' && define.amd)\n  # Requirejs\n  define(-> ChapinUtils)\nelse if (typeof window is 'object')\n  # Browser\n  window.ChapinUtils = ChapinUtils\nelse\n  root.ChapinUtils = ChapinUtils\n"]}